## Documentation: http://docs.travis-ci.com/user/languages/julia/

notifications:
  email: false

language: julia

os:
  - linux
# - osx # TODO: Got errors on starting postgresql

services:
  - postgresql

addons:
  apt:
    packages:
      - unixodbc
      - unixodbc-dev
      - odbc-postgresql

julia:
  - 1.0

env:
  - POSTGRESQL_VERSION=9.6 PGHOST="/var/run/postgresql" ODBC_TEST_DRIVERS="postgresql"

before_script:
  # linux - PostgreSQL - 9.6.6
  - if [[ "$TRAVIS_OS_NAME" == linux ]]; then sudo service postgresql stop && sudo service postgresql start $POSTGRESQL_VERSION            ; fi
  - if [[ "$TRAVIS_OS_NAME" == linux ]]; then psql --version                                                                               ; fi
  - if [[ "$TRAVIS_OS_NAME" == linux ]]; then psql -U postgres -tc 'SHOW server_version'                                                   ; fi
  - if [[ "$TRAVIS_OS_NAME" == linux ]]; then psql -U postgres -c '\conninfo'                                                              ; fi

  # PostgreSQL
  - psql -c "CREATE DATABASE postgresqltest;" -U postgres
  - psql --version

  # ODBC
  - julia -e 'using Pkg; pkg"add ODBC"; pkg"precompile"'
  - julia --color=yes -e 'using ODBC; setupdir=normpath(pathof(ODBC), "..", "..", "test", "setup"); run(`odbcinst -i -s -h -f $(normpath(setupdir, "postgresqltest.odbc.ini"))`)'

  # master updates: LegacyStrings v0.4.0 - WARNING: could not import Base.lcfirst into LegacyStrings
  - julia -e 'using Pkg; pkg"add LegacyStrings#master"; pkg"precompile"'
